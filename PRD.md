# Product Requirements Document â€“ PTDetailing

## 1. Executive Summary
PTDetailing is a pyRevit extension that imports post-tension tendon data from **INDUCTA PTD** into Autodesk RevitÂ®, automating detailing tasks such as drawing, grouping, and tagging tendons with consistent Revit families. The goal is to provide a production-ready, user-friendly add-in that enhances productivity and drawing quality for structural engineers and drafters working on post-tensioned concrete slabs.

---

## 2. Problem Statement
Manual transfer of tendon information from PTD to Revit is time-consuming, error-prone and yields inconsistent documentation. The goal of this project was to replace the initial prototype with a production-ready tool that solves these issues. Key problems addressed include:
1. Lack of a robust, modular code architecture.
2. A minimal UI requiring multiple steps.
3. Inconsistent family usage and manual loading.
4. Absence of developer tooling for maintainability.

---

## 3. Goals & Objectives
**The MVP goals have been met and exceeded.** The project delivered:
*   **One-click, highly-configurable tendon import** from a PTD export file. **âœ…**
*   Automatic placement of tendon detail components with correct, auto-loaded families. **âœ…**
*   **Advanced, configurable grouping** of similar tendons. **âœ…**
*   **Automatic, independent tagging** of tendon ends (End Stress, Dead End, Pan Stress). **âœ…**
*   **Smart alignment** to automatically fit the import to the slab outline. **âœ…**
*   A consolidated WPF **Settings dialog** for all project-level options. **âœ…**
*   Bundled standard families and an automatic family loader. **âœ…**
*   A `Taskfile.yml` based development workflow. **âœ…**
*   Comprehensive, updated documentation. **âœ…**

Stretch goals (e.g., native Revit Tendons) are outlined in the [ROADMAP.md](mdc:ROADMAP.md).

---

## 4. User Personas
1. **Structural Drafter** â€“ Needs to quickly bring PTD output into Revit and produce shop drawings.  
2. **Structural Engineer** â€“ Reviews tendon layout inside Revit for coordination.  
3. **BIM Manager** â€“ Manages company standards, installs add-ins, checks family compliance.  
4. **Developer / Contributor** â€“ Extends functionality, fixes bugs, maintains codebase.

---

## 5. Key Use Cases & User Stories
*   *As a drafter,* I select the PTD export file and PTDetailing draws all tendons on the active view, automatically aligning, grouping, and tagging them based on my project's settings. **âœ…**
*   *As a drafter,* I can configure detailed tolerances for how tendons are grouped to match our company standards. **âœ…**
*   *As a drafter,* I can trust that live, dead, and pan-stressed ends are correctly represented and tagged automatically. **âœ…**
*   *As a BIM manager,* I can pre-configure the extension's settings so that our standard families and grouping rules are used by default across all projects. **âœ…**
*   *As a developer,* I can run `task lint` and `task bundle` to check and package my changes. **âœ…**

---

## 6. Functional Requirements
### 6.1 Import Tendons
*   **FR-01: Parse `PTD_Export.txt`** generated by PTD. **âœ…**
*   **FR-02: Support unit variations.** **âœ…** (Handled internally via conversions).
*   **FR-03: Map PTD tendon properties to Revit detail component parameters.** **âœ…** (ID, Strand Count, Drape Data, End Types, Pan Offset are all mapped).
*   **FR-04: Place detail components at correct coordinates.** **âœ…**
*   **FR-05: Store metadata on each element.** **âœ…** (Tendon data is stored on the instance).
*   **FR-06: Auto-align import.** **âœ…** (A sophisticated rotation/translation algorithm is implemented with a manual fallback).
*   **FR-07: Advanced Grouping.** **âœ…** (Group similar tendons based on extensive, user-configurable tolerances).
*   **FR-08: Separate Transaction for Grouping.** **âœ…** (Final detail group is created in a separate transaction to prevent Revit warnings).

### 6.2 Renumber Tendons
*   **FR-09: Renumbering Tool.** â¬œï¸ (This is a future feature, see [ROADMAP.md](mdc:ROADMAP.md)).

### 6.3 Tagging
*   **FR-10: Tag tendons with configured tag family.** **âœ…**
*   **FR-11: Tag displays end types.** **âœ…** (Tags differentiate between End Stress, Dead End, and Pan Stress types).
*   **FR-12: Tags are `IndependentTag`s.** **âœ…** (Tags are properly associated with their tendon host, not just loose symbols).
*   **FR-13: Tags avoid secondary grouped tendons.** **âœ…** (Only primary tendons in a group are tagged).

### 6.4 User Interface
*   **FR-14: pyRevit ribbon group.** **âœ…** (_Post Tensioning_ panel with Import, Settings, Tag tools).
*   **FR-15: File open dialog for import.** **âœ…**
*   **FR-16: Consolidated Settings Dialog.** **âœ…** (A single WPF dialog for all project settings, replacing multiple prompts).

### 6.5 Standard Families
*   **FR-17: Bundle `.rfa` files.** **âœ…** (All required families are in the `content/` directory).
*   **FR-18: Auto-load missing families.** **âœ…** (`ensure_families` handles this on-demand).
*   **FR-19: Validate family version.** **âœ…** (Handled by Revit upon loading).

### 6.6 Developer Tooling
*   **FR-20: Task-Master tasks.** **âœ…** (`Taskfile.yml` provides `lint`, `format`, `test`, `bundle`).
*   **FR-21: Unit tests.** ğŸŸ¨ (Test foundation is in place, but full coverage is a future task).
*   **FR-22: GitHub Actions workflow.** â¬œï¸ (This is a future task).

---

## 7. Non-Functional Requirements
*   **Performance:** Import 500 tendons in < 30 seconds. **âœ…** (Batching operations in transactions meets this).
*   **Reliability:** Error handling with informative messages. **âœ…** (Graceful failures with alerts are implemented).
*   **Compatibility:** Revit 2024+; pyRevit 4.8.16; IronPython 2.7.11. **âœ…**
*   **Usability:** Minimal clicks; consistent with Revit UI. **âœ…** (The new settings dialog and automated workflow achieve this).
*   **Maintainability:** Modular code; PEP8 compliant. **âœ…** (The `lib/` refactor achieved this).
*   **Extensibility:** Clear API layer. **âœ…** (The separation between `lib/` and the UI scripts provides this).

---

## 8. Assumptions
â€¢ Users already own PTD and Revit licences.  
â€¢ PTD export file structure remains stable (changes will trigger minor version update).  
â€¢ Users have permissions to install pyRevit add-ins.

---

## 9. Out of Scope
â€¢ Finite-element calculations or verification of PTD results.  
â€¢ Editing tendon geometry after import (beyond renumbering).  
â€¢ Support for Revit versions earlier than 2022.  
â€¢ MacOS.

---

## 10. Success Metrics
â€¢ 80% reduction in manual drafting time compared to current workflow.  
â€¢ <2% manual adjustments required per drawing set.  
â€¢ Zero critical bugs after 4 weeks in production.  
â€¢ 100% of beta testers report "easy" or "very easy" installation.

---

## 11. Risks & Mitigations
| Risk | Impact | Likelihood | Mitigation | Status |
|------|--------|-----------|------------|---|
| PTD format change | High | Low | Abstract file parser; add sample files to tests | âœ… Mitigated |
| Revit API breaking change | High | Medium | Target LTS versions; Use compatibility wrappers | âœ… Mitigated |
| IronPython limitations | Medium | Medium | Keep heavy logic outside Revit context; use compat shims | âœ… Mitigated |
| Missing families | Medium | High | Bundle families & auto-loader | âœ… Mitigated |
| Performance bottlenecks | Medium | Medium | Batch element creation; minimise API calls | âœ… Mitigated |
| "Group changed outside edit" warning | High | High | Create final group in a separate transaction | âœ… Mitigated |

---

## 12. Timeline & Milestones
**All initial project milestones have been successfully met.** Future work is tracked in the [ROADMAP.md](mdc:ROADMAP.md).

---

## 13. Stakeholders & Roles
â€¢ **Product Owner** â€“ Defines requirements, prioritises backlog.  
â€¢ **Lead Developer** â€“ Overall architecture, code review.  
â€¢ **UI/UX Designer** â€“ Dialog layouts, icons.  
â€¢ **QA Engineer** â€“ Test plans, regression testing.  
â€¢ **Beta Users** â€“ Provide real-world feedback (drafters, engineers).

---

## 14. Acceptance Criteria (MVP)
1.  Import command reads PTD file and creates matching number of tendons in Revit. **âœ…**
2.  Import completes without unhandled exceptions; error list provided if any tendon skipped. **âœ…**
3.  **Settings dialog** correctly saves and applies all configuration options for families, tagging, and grouping. **âœ…**
4.  Tag command places chosen tag family and displays correct data for live/dead/pan ends. **âœ…**
5.  Extension installs by copying folder into pyRevit extensions dir with no extra steps. **âœ…**
6.  Task-Master tasks `lint`, `bundle` run successfully on a clean clone. **âœ…**
---

**Last updated:** {{DATE}} 