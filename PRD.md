# Product Requirements Document – PTDetailing

## 1. Executive Summary
PTDetailing is a pyRevit extension that imports post-tension tendon data from **INDUCTA PTD** into Autodesk Revit®, automating detailing tasks such as drawing, grouping, and tagging tendons with consistent Revit families. The goal is to provide a production-ready, user-friendly add-in that enhances productivity and drawing quality for structural engineers and drafters working on post-tensioned concrete slabs.

---

## 2. Problem Statement
Manual transfer of tendon information from PTD to Revit is time-consuming, error-prone and yields inconsistent documentation. The goal of this project was to replace the initial prototype with a production-ready tool that solves these issues. Key problems addressed include:
1. Lack of a robust, modular code architecture.
2. A minimal UI requiring multiple steps.
3. Inconsistent family usage and manual loading.
4. Absence of developer tooling for maintainability.

---

## 3. Goals & Objectives
**The MVP goals have been met and exceeded.** The project delivered:
*   **One-click, highly-configurable tendon import** from a PTD export file. **✅**
*   Automatic placement of tendon detail components with correct, auto-loaded families. **✅**
*   **Advanced, configurable grouping** of similar tendons. **✅**
*   **Automatic, independent tagging** of tendon ends (End Stress, Dead End, Pan Stress). **✅**
*   **Smart alignment** to automatically fit the import to the slab outline. **✅**
*   A consolidated WPF **Settings dialog** for all project-level options. **✅**
*   Bundled standard families and an automatic family loader. **✅**
*   A `Taskfile.yml` based development workflow. **✅**
*   Comprehensive, updated documentation. **✅**

Stretch goals (e.g., native Revit Tendons) are outlined in the [ROADMAP.md](mdc:ROADMAP.md).

---

## 4. User Personas
1. **Structural Drafter** – Needs to quickly bring PTD output into Revit and produce shop drawings.  
2. **Structural Engineer** – Reviews tendon layout inside Revit for coordination.  
3. **BIM Manager** – Manages company standards, installs add-ins, checks family compliance.  
4. **Developer / Contributor** – Extends functionality, fixes bugs, maintains codebase.

---

## 5. Key Use Cases & User Stories
*   *As a drafter,* I select the PTD export file and PTDetailing draws all tendons on the active view, automatically aligning, grouping, and tagging them based on my project's settings. **✅**
*   *As a drafter,* I can configure detailed tolerances for how tendons are grouped to match our company standards. **✅**
*   *As a drafter,* I can trust that live, dead, and pan-stressed ends are correctly represented and tagged automatically. **✅**
*   *As a BIM manager,* I can pre-configure the extension's settings so that our standard families and grouping rules are used by default across all projects. **✅**
*   *As a developer,* I can run `task lint` and `task bundle` to check and package my changes. **✅**

---

## 6. Functional Requirements
### 6.1 Import Tendons
*   **FR-01: Parse `PTD_Export.txt`** generated by PTD. **✅**
*   **FR-02: Support unit variations.** **✅** (Handled internally via conversions).
*   **FR-03: Map PTD tendon properties to Revit detail component parameters.** **✅** (ID, Strand Count, Drape Data, End Types, Pan Offset are all mapped).
*   **FR-04: Place detail components at correct coordinates.** **✅**
*   **FR-05: Store metadata on each element.** **✅** (Tendon data is stored on the instance).
*   **FR-06: Auto-align import.** **✅** (A sophisticated rotation/translation algorithm is implemented with a manual fallback).
*   **FR-07: Advanced Grouping.** **✅** (Group similar tendons based on extensive, user-configurable tolerances).
*   **FR-08: Separate Transaction for Grouping.** **✅** (Final detail group is created in a separate transaction to prevent Revit warnings).

### 6.2 Renumber Tendons
*   **FR-09: Renumbering Tool.** ⬜️ (This is a future feature, see [ROADMAP.md](mdc:ROADMAP.md)).

### 6.3 Tagging
*   **FR-10: Tag tendons with configured tag family.** **✅**
*   **FR-11: Tag displays end types.** **✅** (Tags differentiate between End Stress, Dead End, and Pan Stress types).
*   **FR-12: Tags are `IndependentTag`s.** **✅** (Tags are properly associated with their tendon host, not just loose symbols).
*   **FR-13: Tags avoid secondary grouped tendons.** **✅** (Only primary tendons in a group are tagged).

### 6.4 User Interface
*   **FR-14: pyRevit ribbon group.** **✅** (_Post Tensioning_ panel with Import, Settings, Tag tools).
*   **FR-15: File open dialog for import.** **✅**
*   **FR-16: Consolidated Settings Dialog.** **✅** (A single WPF dialog for all project settings, replacing multiple prompts).

### 6.5 Standard Families
*   **FR-17: Bundle `.rfa` files.** **✅** (All required families are in the `content/` directory).
*   **FR-18: Auto-load missing families.** **✅** (`ensure_families` handles this on-demand).
*   **FR-19: Validate family version.** **✅** (Handled by Revit upon loading).

### 6.6 Developer Tooling
*   **FR-20: Task-Master tasks.** **✅** (`Taskfile.yml` provides `lint`, `format`, `test`, `bundle`).
*   **FR-21: Unit tests.** 🟨 (Test foundation is in place, but full coverage is a future task).
*   **FR-22: GitHub Actions workflow.** ⬜️ (This is a future task).

---

## 7. Non-Functional Requirements
*   **Performance:** Import 500 tendons in < 30 seconds. **✅** (Batching operations in transactions meets this).
*   **Reliability:** Error handling with informative messages. **✅** (Graceful failures with alerts are implemented).
*   **Compatibility:** Revit 2024+; pyRevit 4.8.16; IronPython 2.7.11. **✅**
*   **Usability:** Minimal clicks; consistent with Revit UI. **✅** (The new settings dialog and automated workflow achieve this).
*   **Maintainability:** Modular code; PEP8 compliant. **✅** (The `lib/` refactor achieved this).
*   **Extensibility:** Clear API layer. **✅** (The separation between `lib/` and the UI scripts provides this).

---

## 8. Assumptions
• Users already own PTD and Revit licences.  
• PTD export file structure remains stable (changes will trigger minor version update).  
• Users have permissions to install pyRevit add-ins.

---

## 9. Out of Scope
• Finite-element calculations or verification of PTD results.  
• Editing tendon geometry after import (beyond renumbering).  
• Support for Revit versions earlier than 2022.  
• MacOS.

---

## 10. Success Metrics
• 80% reduction in manual drafting time compared to current workflow.  
• <2% manual adjustments required per drawing set.  
• Zero critical bugs after 4 weeks in production.  
• 100% of beta testers report "easy" or "very easy" installation.

---

## 11. Risks & Mitigations
| Risk | Impact | Likelihood | Mitigation | Status |
|------|--------|-----------|------------|---|
| PTD format change | High | Low | Abstract file parser; add sample files to tests | ✅ Mitigated |
| Revit API breaking change | High | Medium | Target LTS versions; Use compatibility wrappers | ✅ Mitigated |
| IronPython limitations | Medium | Medium | Keep heavy logic outside Revit context; use compat shims | ✅ Mitigated |
| Missing families | Medium | High | Bundle families & auto-loader | ✅ Mitigated |
| Performance bottlenecks | Medium | Medium | Batch element creation; minimise API calls | ✅ Mitigated |
| "Group changed outside edit" warning | High | High | Create final group in a separate transaction | ✅ Mitigated |

---

## 12. Timeline & Milestones
**All initial project milestones have been successfully met.** Future work is tracked in the [ROADMAP.md](mdc:ROADMAP.md).

---

## 13. Stakeholders & Roles
• **Product Owner** – Defines requirements, prioritises backlog.  
• **Lead Developer** – Overall architecture, code review.  
• **UI/UX Designer** – Dialog layouts, icons.  
• **QA Engineer** – Test plans, regression testing.  
• **Beta Users** – Provide real-world feedback (drafters, engineers).

---

## 14. Acceptance Criteria (MVP)
1.  Import command reads PTD file and creates matching number of tendons in Revit. **✅**
2.  Import completes without unhandled exceptions; error list provided if any tendon skipped. **✅**
3.  **Settings dialog** correctly saves and applies all configuration options for families, tagging, and grouping. **✅**
4.  Tag command places chosen tag family and displays correct data for live/dead/pan ends. **✅**
5.  Extension installs by copying folder into pyRevit extensions dir with no extra steps. **✅**
6.  Task-Master tasks `lint`, `bundle` run successfully on a clean clone. **✅**
---

**Last updated:** {{DATE}} 